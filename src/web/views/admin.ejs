<%- include('partials/header', {user: user, isAdmin: true}) %>
  <div class="content-container">
    <div class="page-hero">
      <h1>üõ°Ô∏è Admin Console</h1>
      <p class="intro-text">Manage applications, linked accounts, and moderation records</p>
    </div>

    <!-- Quick Links -->
    <div class="admin-quick-links">
      <a href="/admin/automod" class="quick-link-card">
        <span class="quick-link-icon">üõ°Ô∏è</span>
        <span class="quick-link-title">Automod</span>
        <span class="quick-link-desc">Configure filters</span>
      </a>
      <a href="/admin/embeds" class="quick-link-card">
        <span class="quick-link-icon">üìã</span>
        <span class="quick-link-title">Custom Embeds</span>
        <span class="quick-link-desc">Create embeds</span>
      </a>
      <a href="/admin/reactionroles" class="quick-link-card">
        <span class="quick-link-icon">üé≠</span>
        <span class="quick-link-title">Reaction Roles</span>
        <span class="quick-link-desc">Self-assign roles</span>
      </a>
      <a href="/admin/auditlog" class="quick-link-card">
        <span class="quick-link-icon">üìú</span>
        <span class="quick-link-title">Audit Log</span>
        <span class="quick-link-desc">View actions</span>
      </a>
    </div>

    <style>
      .admin-quick-links {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
      }
      .quick-link-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1.5rem 1rem;
        background: rgba(255,255,255,0.02);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 12px;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s;
      }
      .quick-link-card:hover {
        background: rgba(59, 130, 246, 0.1);
        border-color: rgba(59, 130, 246, 0.3);
        transform: translateY(-2px);
      }
      .quick-link-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      .quick-link-title {
        font-weight: 600;
        font-size: 1rem;
      }
      .quick-link-desc {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-top: 0.25rem;
      }
    </style>

    <!-- Pending Applications -->
    <div class="table-section">
      <h3>üìù Pending Applications <span class="count"><%= (applications || []).length %></span></h3>
      <div class="table-container">
        <% if ((applications || []).length === 0) { %>
          <div class="empty-state">
            <h4>No pending applications</h4>
            <p>All applications have been processed</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Discord</th>
                <th>Player</th>
                <th>Platform</th>
                <th>Submitted</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% (applications || []).forEach(function(a){ %>
                <tr>
                  <td class="mono muted"><%= String(a._id).substring(0, 8) %>...</td>
                  <td><%= a.discordId %></td>
                  <td><strong><%= a.playerName %></strong></td>
                  <td><%= a.platform %></td>
                  <td class="muted"><%= a.createdAt ? new Date(a.createdAt).toLocaleDateString() : '‚Äî' %></td>
                  <td><a class="btn btn-sm btn-secondary" href="/admin/application/<%= a._id %>">View</a></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
      <% if (pagination && pagination.app && pagination.app.pages > 1) { %>
        <div class="pagination">
          <% for (let p=1; p<=pagination.app.pages; p++) { %>
            <a class="btn btn-sm <%= p===pagination.app.page ? 'btn-primary' : 'btn-secondary' %>" href="/admin?apppage=<%= p %>&linkedpage=<%= pagination.linked.page %>"><%= p %></a>
          <% } %>
        </div>
      <% } %>
    </div>

    <!-- Linked Accounts -->
    <div class="table-section">
      <h3>üîó Linked Accounts <span class="count"><%= (linked || []).length %></span></h3>
      <div class="table-container">
        <% if ((linked || []).length === 0) { %>
          <div class="empty-state">
            <h4>No linked accounts</h4>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Discord</th>
                <th>Minecraft</th>
                <th>UUID</th>
                <th>Platform</th>
                <th>Linked</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <% (linked || []).forEach(function(l){ %>
                <tr>
                  <td><a href="https://discord.com/users/<%= l.discordId %>" target="_blank" class="mono"><%= l.discordId %></a></td>
                  <td><strong><%= l.minecraftUsername %></strong></td>
                  <td class="mono muted"><%= l.uuid ? l.uuid.substring(0, 8) + '...' : '‚Äî' %></td>
                  <td><%= l.platform %></td>
                  <td class="muted"><%= l.linkedAt ? new Date(l.linkedAt).toLocaleDateString() : '-' %></td>
                  <td><a class="btn btn-sm btn-danger" href="/admin/unlink/<%= l._id %>" onclick="return confirm('Unlink this account?')">Unlink</a></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
      <% if (pagination && pagination.linked && pagination.linked.pages > 1) { %>
        <div class="pagination">
          <% for (let p=1; p<=pagination.linked.pages; p++) { %>
            <a class="btn btn-sm <%= p===pagination.linked.page ? 'btn-primary' : 'btn-secondary' %>" href="/admin?apppage=<%= pagination.app.page %>&linkedpage=<%= p %>"><%= p %></a>
          <% } %>
        </div>
      <% } %>
    </div>
  </div>
<%- include('partials/footer') %>
