<%- include('partials/header', {user: user, isAdmin: typeof isAdmin !== 'undefined' ? isAdmin : false}) %>
  <div class="content-container">
    <div class="page-hero">
      <h1>üìã Cases</h1>
      <p class="intro-text">Browse warnings, bans, fines and linked accounts</p>
    </div>

    <!-- Warnings Section -->
    <div class="table-section">
      <h3>‚ö†Ô∏è Warnings <span class="count"><%= warnings.length %></span></h3>
      <div class="table-container">
        <% if (warnings.length === 0) { %>
          <div class="empty-state">
            <h4>No warnings found</h4>
            <p>All clear!</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Player</th>
                <th>Staff</th>
                <th>Reason</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% warnings.forEach(function(w){ %>
                <tr>
                  <td><a href="/user/<%= w.uuid || w.playerName %>" class="case-id">#<%= w.caseNumber || '‚Äî' %></a></td>
                  <td><a href="/user/<%= w.uuid || w.playerName %>"><%= w.playerName %></a></td>
                  <td><%= w.staffName %></td>
                  <td><%= w.reason %></td>
                  <td class="muted"><%= new Date(w.createdAt).toLocaleDateString() %></td>
                  <td><span class="status <%= w.active ? 'active' : 'removed' %>"><%= w.active ? 'Active' : 'Removed' %></span></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Unpaid Fines Section -->
    <div class="table-section">
      <h3>üí∞ Unpaid Fines <span class="count"><%= (unpaidFines || []).length %></span></h3>
      <div class="table-container">
        <% if ((unpaidFines || []).length === 0) { %>
          <div class="empty-state">
            <h4>No unpaid fines</h4>
            <p>Everyone's settled up!</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Player</th>
                <th>Amount</th>
                <th>Staff</th>
                <th>Issued</th>
              </tr>
            </thead>
            <tbody>
              <% (unpaidFines || []).forEach(function(f){ %>
                <tr>
                  <td><a href="/user/<%= f.uuid || f.playerName %>" class="case-id">#<%= f.caseNumber || '‚Äî' %></a></td>
                  <td><a href="/user/<%= f.uuid || f.playerName %>"><%= f.playerName %></a></td>
                  <td><strong>$<%= f.amount %></strong></td>
                  <td><%= f.staffName %></td>
                  <td class="muted"><%= new Date(f.createdAt).toLocaleDateString() %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Paid Fines Section -->
    <div class="table-section">
      <h3>‚úÖ Paid Fines <span class="count"><%= (paidFines || []).length %></span></h3>
      <div class="table-container">
        <% if ((paidFines || []).length === 0) { %>
          <div class="empty-state">
            <h4>No paid fines</h4>
          </div>
        <% } else { %>
          <table class="muted">
            <thead>
              <tr>
                <th>Case</th>
                <th>Player</th>
                <th>Amount</th>
                <th>Staff</th>
                <th>Paid At</th>
              </tr>
            </thead>
            <tbody>
              <% (paidFines || []).forEach(function(f){ %>
                <tr>
                  <td><a href="/user/<%= f.uuid || f.playerName %>" class="case-id">#<%= f.caseNumber || '‚Äî' %></a></td>
                  <td><a href="/user/<%= f.uuid || f.playerName %>"><%= f.playerName %></a></td>
                  <td>$<%= f.amount %></td>
                  <td><%= f.staffName %></td>
                  <td><%= f.paidAt ? new Date(f.paidAt).toLocaleDateString() : '‚Äî' %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Active Bans Section -->
    <div class="table-section">
      <h3>üî® Active Bans <span class="count"><%= activeBans.length %></span></h3>
      <div class="table-container">
        <% if (activeBans.length === 0) { %>
          <div class="empty-state">
            <h4>No active bans</h4>
            <p>Server is ban-free!</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Player</th>
                <th>Duration</th>
                <th>Reason</th>
                <% if (typeof isAdmin !== 'undefined' && isAdmin) { %><th>Actions</th><% } %>
              </tr>
            </thead>
            <tbody>
              <% activeBans.forEach(function(b){ %>
                <tr>
                  <td><a href="/user/<%= b.uuid || b.playerName %>" class="case-id">#<%= b.caseNumber || '‚Äî' %></a></td>
                  <td><a href="/user/<%= b.uuid || b.playerName %>"><%= b.playerName %></a></td>
                  <td><span class="status banned"><%= typeof formatDuration === 'function' ? formatDuration(b.duration, b.createdAt, b.expiresAt) : (b.duration ? b.duration : (b.expiresAt ? 'temp' : 'Permanent')) %></span></td>
                  <td><%= b.reason %></td>
                  <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                    <td><a href="/admin/ban/<%= b._id %>/edit" class="action-link">‚úèÔ∏è Edit</a></td>
                  <% } %>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Inactive Bans Section -->
    <div class="table-section">
      <h3>üìú Inactive Bans <span class="count"><%= inactiveBans.length %></span></h3>
      <div class="table-container">
        <% if (inactiveBans.length === 0) { %>
          <div class="empty-state">
            <h4>No inactive bans</h4>
          </div>
        <% } else { %>
          <table class="muted">
            <thead>
              <tr>
                <th>Case</th>
                <th>Player</th>
                <th>Duration</th>
                <th>Reason</th>
                <% if (typeof isAdmin !== 'undefined' && isAdmin) { %><th>Actions</th><% } %>
              </tr>
            </thead>
            <tbody>
              <% inactiveBans.forEach(function(b){ %>
                <tr>
                  <td><a href="/user/<%= b.uuid || b.playerName %>" class="case-id">#<%= b.caseNumber || '‚Äî' %></a></td>
                  <td><a href="/user/<%= b.uuid || b.playerName %>"><%= b.playerName %></a></td>
                  <td><%= typeof formatDuration === 'function' ? formatDuration(b.duration, b.createdAt, b.expiresAt) : (b.duration ? b.duration : (b.expiresAt ? 'temp' : 'Permanent')) %></td>
                  <td><%= b.reason %></td>
                  <% if (typeof isAdmin !== 'undefined' && isAdmin) { %>
                    <td><a href="/admin/ban/<%= b._id %>/edit" class="action-link">‚úèÔ∏è Edit</a></td>
                  <% } %>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Linked Accounts Section -->
    <div class="table-section">
      <h3>üîó Linked Accounts <span class="count"><%= (linked || []).length %></span></h3>
      <div class="table-container">
        <% if ((linked || []).length === 0) { %>
          <div class="empty-state">
            <h4>No linked accounts</h4>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Discord ID</th>
                <th>Minecraft</th>
                <th>UUID</th>
                <th>Platform</th>
                <th>Linked</th>
              </tr>
            </thead>
            <tbody>
              <% (linked || []).forEach(function(l){ %>
                <tr>
                  <td><a href="https://discord.com/users/<%= l.discordId %>" target="_blank" class="mono"><%= l.discordId %></a></td>
                  <td><strong><%= l.minecraftUsername %></strong></td>
                  <td class="mono muted"><%= l.uuid ? l.uuid.substring(0, 8) + '...' : '‚Äî' %></td>
                  <td><%= l.platform %></td>
                  <td class="muted"><%= l.linkedAt ? new Date(l.linkedAt).toLocaleDateString() : '‚Äî' %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>
  </div>
<%- include('partials/footer') %>