<%- include('partials/header', {user: user, isAdmin: typeof isAdmin !== 'undefined' ? isAdmin : false}) %>
  <div class="content-container">
    <div class="page-hero">
      <h1>üë§ User: <%= target %></h1>
      <p class="intro-text">Complete moderation history for this player</p>
    </div>

    <!-- Warnings -->
    <div class="table-section">
      <h3>‚ö†Ô∏è Warnings <span class="count"><%= warnings.length %></span></h3>
      <div class="table-container">
        <% if (warnings.length === 0) { %>
          <div class="empty-state">
            <h4>No warnings</h4>
            <p>This player has no warnings on record</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Reason</th>
                <th>Staff</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% warnings.forEach(function(w){ %>
                <tr>
                  <td class="case-id">#<%= w.caseNumber || '‚Äî' %></td>
                  <td><%= w.reason %></td>
                  <td><%= w.staffName %></td>
                  <td class="muted"><%= new Date(w.createdAt).toLocaleDateString() %></td>
                  <td><span class="status <%= w.active ? 'active' : 'removed' %>"><%= w.active ? 'Active' : 'Removed' %></span></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Bans -->
    <div class="table-section">
      <h3>üî® Bans <span class="count"><%= bans.length %></span></h3>
      <div class="table-container">
        <% if (bans.length === 0) { %>
          <div class="empty-state">
            <h4>No bans</h4>
            <p>This player has never been banned</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Reason</th>
                <th>Staff</th>
                <th>Duration</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% bans.forEach(function(b){ %>
                <tr>
                  <td class="case-id">#<%= b.caseNumber || '‚Äî' %></td>
                  <td><%= b.reason %></td>
                  <td><%= b.staffName %></td>
                  <td><%= typeof formatDuration === 'function' ? formatDuration(b.duration, b.createdAt, b.expiresAt) : (b.duration ? b.duration : (b.expiresAt ? 'temp' : 'Permanent')) %></td>
                  <td class="muted"><%= new Date(b.createdAt).toLocaleDateString() %></td>
                  <td><span class="status <%= b.active ? 'banned' : 'inactive' %>"><%= b.active ? 'Active' : 'Unbanned' %></span></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <!-- Fines -->
    <div class="table-section">
      <h3>üí∞ Fines <span class="count"><%= fines.length %></span></h3>
      <div class="table-container">
        <% if (fines.length === 0) { %>
          <div class="empty-state">
            <h4>No fines</h4>
            <p>This player has no fines on record</p>
          </div>
        <% } else { %>
          <table>
            <thead>
              <tr>
                <th>Case</th>
                <th>Amount</th>
                <th>Note</th>
                <th>Staff</th>
                <th>Issued</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <% fines.forEach(function(f){ %>
                <tr>
                  <td class="case-id">#<%= f.caseNumber || '‚Äî' %></td>
                  <td><strong>$<%= f.amount %></strong></td>
                  <td><%= f.note || '‚Äî' %></td>
                  <td><%= f.staffName %></td>
                  <td class="muted"><%= new Date(f.createdAt).toLocaleDateString() %></td>
                  <td><span class="status <%= f.paid ? 'paid' : 'unpaid' %>"><%= f.paid ? 'Paid' : 'Unpaid' %></span></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>
    </div>

    <div style="margin-top:24px">
      <a href="/cases" class="btn btn-secondary">‚Üê Back to Cases</a>
    </div>
  </div>
<%- include('partials/footer') %>